#include "kmr_03.h"

#include "world/common/SomeMatrixOperations.inc.c"

// 8C9780
// *INDENT-OFF*
Script M(script_SearchBush_802417F0) = {
    SI_USE_BUFFER(SI_VAR(0)),
    SI_CMD(0x34, 0xFE363C81, 0xFE363C82, 0xFE363C83, 0xFE363C84),
    SI_CALL(0x802D1DFC, SI_VAR(5), SI_VAR(15), SI_VAR(7)),
    SI_THREAD(),
        SI_SET(SI_FLAG(0), 0),
        SI_IF_NE(SI_VAR(1), 0),
            SI_LOOP(5),
                SI_USE_BUFFER(SI_VAR(1)),
                SI_CMD(0x31, 0xFE363C82),
                SI_LOOP(SI_VAR(2)),
                    SI_CMD(0x31, 0xFE363C83),
                    SI_CALL(SomeMatrixOperation2, SI_VAR(3), SI_FIXED(0.1), 1, SI_VAR(15), 0),
                    SI_IF_EQ(SI_FLAG(0), 0),
                        SI_SET(SI_FLAG(0), 1),
                        SI_CALL(0x802CA558, SI_VAR(3), 339, 0),
                    SI_END_IF(),
                SI_END_LOOP(),
                SI_WAIT_FRAMES(1),
                SI_USE_BUFFER(SI_VAR(1)),
                SI_CMD(0x31, 0xFE363C82),
                SI_LOOP(SI_VAR(2)),
                    SI_CMD(0x31, 0xFE363C83),
                    SI_CALL(SomeMatrixOperation2, SI_VAR(3), SI_FIXED(0.1), -1, SI_VAR(15), 0),
                SI_END_LOOP(),
                SI_WAIT_FRAMES(1),
            SI_END_LOOP(),
            SI_USE_BUFFER(SI_VAR(1)),
            SI_CMD(0x31, 0xFE363C82),
            SI_LOOP(SI_VAR(2)),
                SI_CMD(0x31, 0xFE363C83),
                SI_CALL(0x802C8B60, SI_VAR(3), 0, 0, 0),
            SI_END_LOOP(),
            SI_WAIT_FRAMES(1),
        SI_END_IF(),
    SI_END_THREAD(),
    SI_THREAD(),
        SI_IF_NE(SI_VAR(2), 0),
            SI_USE_BUFFER(SI_VAR(2)),
            SI_CMD(0x31, 0xFE363C83),
            SI_LOOP(SI_VAR(3)),
                SI_CMD(0x31, 0xFE363C84),
                SI_CMD(0x33, 0xFE363C85, 0xFE363C86, 0xFE363C87),
                SI_CMD(0x33, 0xFE363C88, 0xFE363C89, 0xFE363C8A),
                SI_IF_EQ(SI_VAR(10), 0),
                    SI_CALL(0x802D6DC0, SI_VAR(4), SI_VAR(5), SI_VAR(6), SI_VAR(7), SI_VAR(8), SI_VAR(9)),
                    SI_ELSE(),
                    SI_CALL(0x802D593C, SI_VAR(10), SI_VAR(11)),
                    SI_IF_EQ(SI_VAR(11), 0),
                        SI_CALL(0x802D58E0, SI_VAR(10), 1),
                        SI_CALL(0x802D6DC0, SI_VAR(4), SI_VAR(5), SI_VAR(6), SI_VAR(7), SI_VAR(8), SI_VAR(9)),
                    SI_END_IF(),
                SI_END_IF(),
            SI_END_LOOP(),
        SI_END_IF(),
    SI_END_THREAD(),
    SI_WAIT_FRAMES(15),
    SI_IF_NE(SI_VAR(4), 0),
        SI_EXEC_WAIT(0xFE363C84),
    SI_END_IF(),
    SI_RETURN(),
    SI_END(),
};
// *INDENT-ON*

// *INDENT-OFF*
Script M(script_ShakeTree_80241B50) = {
    SI_TIMESCALE(SI_FIXED(2.0f)),
    SI_USE_BUFFER(SI_VAR(0)),
    SI_CMD(0x34, 0xFE363C81, 0xFE363C82, 0xFE363C83, 0xFE363C84),
    SI_CMD(0x31, 0xFE363C85),
    SI_CALL(0x802D1DFC, SI_VAR(6), SI_VAR(15), SI_VAR(8)),
    SI_CALL(0x802D6150, 357),
    SI_CALL(0x802D6150, 358),
    SI_THREAD(),
        SI_SET(SI_FLAG(0), 0),
        SI_IF_NE(SI_VAR(1), 0),
            SI_WAIT_FRAMES(1),
            SI_LOOP(5),
                SI_USE_BUFFER(SI_VAR(1)),
                SI_CMD(0x31, 0xFE363C82),
                SI_LOOP(SI_VAR(2)),
                    SI_CMD(0x31, 0xFE363C83),
                    SI_CALL(SomeMatrixOperation2, SI_VAR(3), SI_FIXED(0.1), SI_FIXED(0.2), SI_VAR(15), 0),
                    SI_IF_EQ(SI_FLAG(0), 0),
                        SI_SET(SI_FLAG(0), 1),
                        SI_CALL(0x802CA558, SI_VAR(3), 358, 0),
                    SI_END_IF(),
                SI_END_LOOP(),
                SI_WAIT_FRAMES(1),
                SI_USE_BUFFER(SI_VAR(1)),
                SI_CMD(0x31, 0xFE363C82),
                SI_LOOP(SI_VAR(2)),
                    SI_CMD(0x31, 0xFE363C83),
                    SI_CALL(SomeMatrixOperation2, SI_VAR(3), SI_FIXED(0.1), SI_FIXED(-0.2), SI_VAR(15), 0),
                SI_END_LOOP(),
                SI_WAIT_FRAMES(1),
            SI_END_LOOP(),
            SI_USE_BUFFER(SI_VAR(1)),
            SI_CMD(0x31, 0xFE363C82),
            SI_LOOP(SI_VAR(2)),
                SI_CMD(0x31, 0xFE363C83),
                SI_CALL(0x802C8B60, SI_VAR(3), 0, 0, 0),
            SI_END_LOOP(),
            SI_WAIT_FRAMES(1),
        SI_END_IF(),
    SI_END_THREAD(),
    SI_THREAD(),
        SI_SET(SI_FLAG(0), 0),
        SI_IF_NE(SI_VAR(2), 0),
            SI_LOOP(5),
                SI_USE_BUFFER(SI_VAR(2)),
                SI_CMD(0x31, 0xFE363C83),
                SI_LOOP(SI_VAR(3)),
                    SI_CMD(0x31, 0xFE363C84),
                    SI_CALL(SomeMatrixOperation2, SI_VAR(4), SI_FIXED(0.1), SI_FIXED(0.2), SI_VAR(15), 0),
                    SI_IF_EQ(SI_FLAG(0), 0),
                        SI_SET(SI_FLAG(0), 1),
                        SI_CALL(0x802CA558, SI_VAR(4), 357, 0),
                    SI_END_IF(),
                SI_END_LOOP(),
                SI_WAIT_FRAMES(1),
                SI_USE_BUFFER(SI_VAR(2)),
                SI_CMD(0x31, 0xFE363C83),
                SI_LOOP(SI_VAR(3)),
                    SI_CMD(0x31, 0xFE363C84),
                    SI_CALL(SomeMatrixOperation2, SI_VAR(4), SI_FIXED(0.1), SI_FIXED(-0.2), SI_VAR(15), 0),
                SI_END_LOOP(),
                SI_WAIT_FRAMES(1),
            SI_END_LOOP(),
            SI_USE_BUFFER(SI_VAR(2)),
            SI_CMD(0x31, 0xFE363C83),
            SI_LOOP(SI_VAR(3)),
                SI_CMD(0x31, 0xFE363C84),
                SI_CALL(0x802C8B60, SI_VAR(4), 0, 0, 0),
            SI_END_LOOP(),
            SI_WAIT_FRAMES(1),
        SI_END_IF(),
    SI_END_THREAD(),
    SI_THREAD(),
        SI_IF_NE(SI_VAR(3), 0),
            SI_USE_BUFFER(SI_VAR(3)),
            SI_CMD(0x31, 0xFE363C84),
            SI_LOOP(SI_VAR(4)),
                SI_CMD(0x31, 0xFE363C85),
                SI_CMD(0x33, 0xFE363C86, 0xFE363C87, 0xFE363C88),
                SI_CMD(0x33, 0xFE363C89, 0xFE363C8A, 0xFE363C8B),
                SI_IF_EQ(SI_VAR(11), 0),
                    SI_CALL(0x802D6DC0, SI_VAR(5), SI_VAR(6), SI_VAR(7), SI_VAR(8), SI_VAR(9), SI_VAR(10)),
                    SI_ELSE(),
                    SI_CALL(0x802D593C, SI_VAR(11), SI_VAR(12)),
                    SI_IF_EQ(SI_VAR(12), 0),
                        SI_CALL(0x802D58E0, SI_VAR(11), 1),
                        SI_CALL(0x802D6DC0, SI_VAR(5), SI_VAR(6), SI_VAR(7), SI_VAR(8), SI_VAR(9), SI_VAR(10)),
                    SI_END_IF(),
                SI_END_IF(),
            SI_END_LOOP(),
        SI_END_IF(),
    SI_END_THREAD(),
    SI_THREAD(),
        SI_IF_NE(SI_VAR(4), 0),
            SI_USE_BUFFER(SI_VAR(4)),
            SI_CMD(0x31, 0xFE363C85),
            SI_LOOP(SI_VAR(5)),
                SI_CMD(0x33, 0xFE363C86, 0xFE363C87, 0xFE363C88),
                SI_CALL(0x802D829C, 20, 0, SI_VAR(6), SI_VAR(7), SI_VAR(8), 100, 0, 0, 0, 0, 0, 0, 0, 0),
            SI_END_LOOP(),
        SI_END_IF(),
    SI_END_THREAD(),
    SI_IF_NE(SI_VAR(5), 0),
        SI_EXEC_WAIT(0xFE363C85),
    SI_END_IF(),
    SI_WAIT_FRAMES(15),
    SI_RETURN(),
    SI_END(),
};
// *INDENT-ON*

s32 M(treeModelList_Bush1_Bush)[] = {
    0x00000001, 0x00000040,
};

s32 M(treeEffectVectors_Bush1)[] = {
    0x00000001, 0x0000008F, 0x00000010, 0x000001CE,
};

s32 M(searchBushEvent_Bush1)[] = {
    M(treeModelList_Bush1_Bush), 0x00000000, M(treeEffectVectors_Bush1), 0x00000000,
};

s32 M(treeModelList_Tree1_Leaves)[] = {
    0x00000001, 0x0000003E,
};

s32 M(treeModelList_Tree1_Trunk)[] = {
    0x00000001, 0x0000003D,
};

s32 M(treeEffectVectors_Tree1)[] = {
    0x00000002, 0xFFFFFFB0, 0x00000082, 0x00000012, 0x0000001C, 0x00000082, 0x00000027,
};

// *INDENT-OFF*
Script M(script_Tree1_Callback) = {
    SI_IF_EQ(SI_SAVE_FLAG(53), 1),
        SI_RETURN(),
    SI_END_IF(),
    SI_IF_EQ(SI_MAP_FLAG(10), 1),
        SI_RETURN(),
    SI_END_IF(),
    SI_WAIT_FRAMES(10),
    SI_CALL(0x802D1DFC, SI_VAR(0), SI_VAR(1), SI_VAR(2)),
    SI_IF_LT(SI_VAR(0), 0xFFFFFFE2),
        SI_CALL(0x802D6CC0, 138, 0xFFFFFFE9, 100, 35, 13, SI_SAVE_FLAG(53)),
        SI_ELSE(),
        SI_CALL(0x802D6CC0, 138, 0xFFFFFFAB, 100, 16, 13, SI_SAVE_FLAG(53)),
    SI_END_IF(),
    SI_SET(SI_MAP_FLAG(10), 1),
    SI_RETURN(),
    SI_END(),
};
// *INDENT-ON*

s32 M(shakeTreeEvent_Tree1)[] = {
    M(treeModelList_Tree1_Leaves), M(treeModelList_Tree1_Trunk), 0x00000000, M(treeEffectVectors_Tree1), M(script_Tree1_Callback),
};

s32 M(triggerCoord_802422A8)[] = {
    0xC2280000, 0x00000000, 0xC1500000, 0x00000000,
};

Script M(script_802422B8) = {
    SI_SET(SI_VAR(0), M(searchBushEvent_Bush1)),
    SI_BIND(M(script_SearchBush_802417F0), TriggerFlag_WALL_INTERACT, 53, NULL),
    SI_SET(SI_VAR(0), M(shakeTreeEvent_Tree1)),
    SI_BIND(M(script_ShakeTree_80241B50), TriggerFlag_WALL_HAMMER, 52, NULL),
    SI_BIND(M(script_ShakeTree_80241B50), TriggerFlag_BOMB, M(triggerCoord_802422A8), NULL),
    SI_RETURN(),
    SI_END(),
};

s32 padding3[] = {0};

// 8CA2D0
// *INDENT-OFF*
Script M(script_80242340) = {
    SI_CALL(0x802CB860, 0, 0xFFFFFEF2, 20, 0xFFFFFFB0),
    SI_CALL(0x802CBE2C, 0, 0xFFFFFEF2, 20, 0xFFFFFFB0),
    SI_CALL(0x802CBBE4, 0, SI_FIXED(700.0f)),
    SI_CALL(0x802CBEF0, 0, SI_FIXED(90.0f)),
    SI_CALL(0x802CB79C, 0, 0, 1),
    SI_IF_GE(SI_SAVE_VAR(0), 0xFFFFFF89),
        SI_CALL(0x802D0EF0, 0, 0xFFFFFC18, 0),
        SI_CALL(0x802D0E28, 1),
        SI_CALL(0x802D0EF0, 0xFFFFFF20, 20, 0xFFFFFFB0),
        SI_CALL(0x802CDCB0, 0xFFFFFFFC, 0xFFFFFF20, 20, 0xFFFFFFB0),
        SI_WAIT_FRAMES(20),
        SI_CALL(0x802CBEF0, 0, SI_FIXED(3.0f)),
        SI_CALL(0x802D1DFC, SI_VAR(0), SI_VAR(1), SI_VAR(2)),
        SI_CALL(0x802CB860, 0, SI_VAR(0), SI_VAR(1), SI_VAR(2)),
        SI_CALL(0x802CBE2C, 0, SI_VAR(0), SI_VAR(1), SI_VAR(2)),
        SI_CALL(0x802CB79C, 0, 0, 1),
        SI_CALL(0x802CC354, 0, SI_FIXED(1.0f)),
        SI_CALL(0x802CB79C, 0, 0, 0),
        SI_CALL(0x802D0E28, 0),
        SI_RETURN(),
    SI_END_IF(),
    SI_CALL(0x802D0E28, 1),
    SI_CALL(0x802D0DE4, 1),
    SI_CALL(0x802D1DFC, SI_VAR(0), SI_VAR(1), SI_VAR(2)),
    SI_CALL(0x802D0EF0, SI_VAR(0), 0xFFFFFC18, SI_VAR(2)),
    SI_WAIT_FRAMES(30),
    SI_CALL(0x802CBBE4, 0, 220),
    SI_CALL(0x802CBEF0, 0, SI_FIXED(1.0f)),
    SI_CALL(0x802CB79C, 0, 0, 1),
    SI_CALL(0x802CC354, 0, SI_FIXED(1.0f)),
    SI_THREAD(),
        SI_WAIT_FRAMES(18),
        SI_CALL(0x802D2CD8, 373, 0),
        SI_WAIT_FRAMES(30),
        SI_CALL(0x802D2CD8, 374, 0),
        SI_WAIT_FRAMES(28),
        SI_CALL(0x802D2CD8, 373, 0),
    SI_END_THREAD(),
    SI_CALL(0x802D0DA0, 1),
    SI_CALL(0x802D1084, 0x10002),
    SI_CALL(0x802D0EF0, 0xFFFFFF20, 120, 0xFFFFFFB0),
    SI_CALL(0x802D193C, 90, 0),
    SI_LABEL(0),
    SI_WAIT_FRAMES(1),
    SI_CALL(0x802D1DFC, SI_VAR(0), SI_VAR(1), SI_VAR(2)),
    SI_ADD(SI_VAR(1), 0xFFFFFFFE),
    SI_CALL(0x802D0EF0, SI_VAR(0), SI_VAR(1), SI_VAR(2)),
    SI_IF_GT(SI_VAR(1), 86),
        SI_GOTO(0),
    SI_END_IF(),
    SI_CALL(0x802D0EF0, 0xFFFFFECA, 20, 0xFFFFFFB0),
    SI_THREAD(),
        SI_WAIT_FRAMES(20),
        SI_CALL(0x802CBE2C, 0, 0xFFFFFECA, 20, 0xFFFFFFB0),
        SI_CALL(0x802CBEF0, 0, SI_FIXED(0.2)),
        SI_CALL(0x802CB79C, 0, 0, 1),
    SI_END_THREAD(),
    SI_CALL(0x802D286C, 0x2800),
    SI_CALL(0x802D2520, 0x10002, 5, 5, 1, 1, 0),
    SI_WAIT_FRAMES(100),
    SI_CALL(0x802CC354, 0, SI_FIXED(1.0f)),
    SI_CALL(0x802D2520, 0x10002, 0, 0, 0, 0, 0),
    SI_CALL(0x802D0DA0, 0),
    SI_CALL(0x802D1084, 0x10006),
    SI_WAIT_FRAMES(10),
    SI_CALL(0x802D1084, 0x10007),
    SI_CALL(0x802D1DFC, SI_VAR(0), SI_VAR(1), SI_VAR(2)),
    SI_CALL(0x802D1054, SI_FIXED(1.0f)),
    SI_CALL(0x802D18E8, SI_VAR(0), SI_VAR(1), SI_VAR(2), 10),
    SI_CALL(0x802D1084, 0x10002),
    SI_THREAD(),
        SI_CALL(0x802CBEF0, 0, SI_FIXED(3.0f)),
        SI_CALL(0x802D1DFC, SI_VAR(0), SI_VAR(1), SI_VAR(2)),
        SI_CALL(0x802CB860, 0, SI_VAR(0), SI_VAR(1), SI_VAR(2)),
        SI_CALL(0x802CBE2C, 0, SI_VAR(0), SI_VAR(1), SI_VAR(2)),
        SI_CALL(0x802CB79C, 0, 0, 1),
        SI_CALL(0x802CC354, 0, SI_FIXED(1.0f)),
        SI_CALL(0x802CB79C, 0, 0, 0),
    SI_END_THREAD(),
    SI_WAIT_FRAMES(30),
    SI_CALL(0x802D0DE4, 0),
    SI_CALL(0x802D0E28, 0),
    SI_RETURN(),
    SI_END(),
};
